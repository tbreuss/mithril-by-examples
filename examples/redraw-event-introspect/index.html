<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="4spLhTDINzdede85HIlvHd0YVnKLKeP1Xw4FnIUaT1Q" />
    <title>Redraw Event Introspection | Mithril.js by Examples</title>
    <link rel="stylesheet" href="/css/pure-min.css?v=1649591713">
    <link rel="stylesheet" href="/css/grids-responsive-min.css?v=1649591713">
    <link rel="stylesheet" href="/css/styles.css?v=1649591713">
    <link rel="stylesheet" href="/css/highlight/styles/atom-one-dark.min.css?v=1649591713">
    <script src="https://flems.io/flems.html" type="text/javascript" charset="utf-8"></script>
  </head>
  <body>
    <div class="header">
      <div class="container">
        <div class="pure-g custom-wrapper" id="menu">
            <div class="pure-u-1 pure-u-md-1-3">
              <div class="pure-menu">
                <a class="pure-menu-heading custom-brand" href="/"><img src="https://mithril.js.org/logo.svg" alt="">Mithril.js by Examples</a>
                <a href="#" class="custom-toggle" id="toggle"><s class="bar"></s><s class="bar"></s></a>
              </div>
            </div>
            <div class="pure-u-1 pure-u-md-2-3">
                <div class="pure-menu pure-menu-horizontal custom-can-transform">
                    <ul class="pure-menu-list">
                        <li class="pure-menu-item pure-menu-selected"><a class="pure-menu-link" href="/examples/">Examples</a></li>
                        <li class="pure-menu-item"><a class="pure-menu-link" href="/tags/">Tags</a></li>
                        <li class="pure-menu-item"><a class="pure-menu-link" href="/contributors/">Contributors</a></li>
                        <li class="pure-menu-item"><a class="pure-menu-link" href="/search/">Search</a></li>
                      </ul>
                </div>
            </div>
        </div>
    </div>
  </div>
    <div class="container content">
  <div class="pure-g">
      <div class="pure-u-1">

        <h1>Redraw Event Introspection</h1>

        <p class="no-margin-bottom">
          <time datetime="2022-02-16">16 February 2022</time><span class="author">
            by&nbsp;<span class="author"><a href="/contributors/jaforbes/">JAForbes</a></span>
          </span>
        </p>
        <p class="no-margin-bottom">Level: <span class="level">expert</span> • Mithril.js Version: <span class="version">2.0.4</span>
        </p>

        <p>
          
          
          <a href="/tags/event/" class="post-tag">event</a>
          
          
          <a href="/tags/m.mount/" class="post-tag">m.mount</a>
          
          
          <a href="/tags/m.redraw/" class="post-tag">m.redraw</a>
          
          
          <a href="/tags/m.request/" class="post-tag">m.request</a>
          
        </p>

        <div class="toc">
        <h2 class="toc__heading">Contents</h2>
        <ol class="toc__list"><li class="toc__item"><a clas="toc__link" href="#live-example">Live Example</a></li><li class="toc__item"><a clas="toc__link" href="#dependencies">Dependencies</a></li><li class="toc__item"><a clas="toc__link" href="#javascript">JavaScript</a></li><li class="toc__item"><a clas="toc__link" href="#css">CSS</a></li><li class="toc__item"><a clas="toc__link" href="#contribute">Contribute</a></li></ol>
    </div>

        
      <h2 id="live-example">Live Example <a class="direct-link" href="#live-example" aria-hidden="true">#</a></h2>
      <div id="flems"></div>
      <script>
      Flems(document.getElementById("flems"), {
        middle: 0,
        resizable: false,
        editable: true,
        toolbar: true,
        autoHeight: false,
        selected: '.js',
        files: [{"name":".js","content":"let oldM = window.m\nlet m = (...args) => {\n  let x = oldM(...args)\n  let stack = (new Error().stack+'').split(/\\bat\\b/gm)[2].trim()\n  let selector = args[0]\n  let [column, ln, file, protocol] = stack.split(':').reverse()\n  column = column.match(/\\d+/)[0]\n\n  if( x.attrs ) {\n    for(let k of Object.keys(x.attrs)){\n      if ( k.slice(0,2) == 'on' ) {\n        let old = x.attrs[k]\n        x.attrs[k] = (...args) => {\n          m.redraw.cause.unshift({\n            type: 'event',\n            selector,\n            vnode: x,\n            where: {\n              column, ln, file, protocol\n            }\n          })\n          return old(...args)\n        }\n      }\n    }\n  }\n\n  return x\n}\n\nm.oldRequest = oldM.request\nconst newRequest = (...args) => {\n\n  let [url, options] =\n    typeof args[0] != 'string'\n    ? [args[0].url, args[0]||{}]\n    : args.concat({})\n\n  let out = m.oldRequest(...args)\n\n  let stack = (new Error().stack+'').split(/\\bat\\b/gm)[2].trim()\n  let selector = args[0]\n  let [column, ln, file, protocol] = stack.split(':').reverse()\n  column = column.match(/\\d+/)[0]\n\n  out.finally( () => {\n    m.redraw.cause.unshift({\n      type: 'request',\n      url,\n      options,\n      where: {\n        column, ln, file, protocol\n      }\n    })\n  })\n  return out\n}\n\nObject.assign(m, oldM, { request: newRequest })\nm.redraw.cause = []\n\nlet renders = 0\nm.mount(document.body, () => ({\n  view: () => [\n    m('button.a', { onclick(){} }, 'Button A'),\n    m('button.b', { onclick(){\n      m.request('https://jsonplaceholder.typicode.com/todos/1')\n    } }, 'Button B'),\n    m('input[type=date]', { oninput(){} }),\n    m('input[type=text]', { oninput(){} }),\n    m('p','Renders: ', ++renders),\n    m.redraw.cause.flatMap(({ vnode, type, url, options, selector, where }) =>\n      type == 'event'\n      ? [\n        m('pre', m('code', `m(\"${selector}\", ${JSON.stringify(vnode.attrs)}, ${vnode.text ? `\"${vnode.text}\"` : ''})`)),\n        ,m('.table'\n          ,Object.entries({ selector, ...where }).map(\n            ([k,v]) =>\n              m('.row'\n                  ,m('.key', k), m('.value', v)\n              )\n          )\n        )\n      ]\n      : type == 'request'\n      ? [\n        ,m('pre', m('code', `m.request(\"${url}\", ${JSON.stringify(options)})`))\n        ,m('.table'\n          ,Object.entries({ ...where }).map(\n            ([k,v]) =>\n              m('.row'\n                  ,m('.key', k), m('.value', v)\n              )\n          )\n        )\n      ]\n      : null\n    )\n  ]\n}))\n"},{"name":".css","content":".row {\n  display: grid;\n  grid-template-columns: 4em 1fr;\n  gap: 1em;\n}\n\n.row .key {\n  font-weight: bold;\n}\n"}],
        links: [{"name":"mithril@2.0.4","type":"script","url":"https://unpkg.com/mithril@2.0.4"},{"name":"bss.js","type":"script","url":"https://unpkg.com/bss@1.6.4/bss.js"}]
      });
      </script>
    
        <div class="dependencies">
          <h2 id="dependencies" class="dependencies__heading" tabindex="-1">Dependencies <a class="direct-link" href="#dependencies" aria-hidden="true">#</a></h2>
          <div class="dependencies__tableWrap">
            <table class="dependencies__table dependencies__table--2">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Name</th>
                        <th>URL</th>
                    </tr>
                </thead>
                <tbody>
                <tr><td class="capitalize">script</td><td>mithril@2.0.4</td><td>https://unpkg.com/mithril@2.0.4</td></tr>,<tr><td class="capitalize">script</td><td>bss.js</td><td>https://unpkg.com/bss@1.6.4/bss.js</td></tr>
                </tbody>
            </table>
          </div>
        </div>
      <h2 id="javascript" tabindex="-1">JavaScript <a class="direct-link" href="#javascript" aria-hidden="true">#</a></h2>
<pre><code class="language-js">let oldM = window.m
let m = (...args) =&gt; {
  let x = oldM(...args)
  let stack = (new Error().stack+'').split(/\bat\b/gm)[2].trim()
  let selector = args[0]
  let [column, ln, file, protocol] = stack.split(':').reverse()
  column = column.match(/\d+/)[0]

  if( x.attrs ) {
    for(let k of Object.keys(x.attrs)){
      if ( k.slice(0,2) == 'on' ) {
        let old = x.attrs[k]
        x.attrs[k] = (...args) =&gt; {
          m.redraw.cause.unshift({
            type: 'event',
            selector,
            vnode: x,
            where: {
              column, ln, file, protocol
            }
          })
          return old(...args)
        }
      }
    }
  }

  return x
}

m.oldRequest = oldM.request
const newRequest = (...args) =&gt; {

  let [url, options] =
    typeof args[0] != 'string'
    ? [args[0].url, args[0]||{}]
    : args.concat({})

  let out = m.oldRequest(...args)

  let stack = (new Error().stack+'').split(/\bat\b/gm)[2].trim()
  let selector = args[0]
  let [column, ln, file, protocol] = stack.split(':').reverse()
  column = column.match(/\d+/)[0]

  out.finally( () =&gt; {
    m.redraw.cause.unshift({
      type: 'request',
      url,
      options,
      where: {
        column, ln, file, protocol
      }
    })
  })
  return out
}

Object.assign(m, oldM, { request: newRequest })
m.redraw.cause = []

let renders = 0
m.mount(document.body, () =&gt; ({
  view: () =&gt; [
    m('button.a', { onclick(){} }, 'Button A'),
    m('button.b', { onclick(){
      m.request('https://jsonplaceholder.typicode.com/todos/1')
    } }, 'Button B'),
    m('input[type=date]', { oninput(){} }),
    m('input[type=text]', { oninput(){} }),
    m('p','Renders: ', ++renders),
    m.redraw.cause.flatMap(({ vnode, type, url, options, selector, where }) =&gt;
      type == 'event'
      ? [
        m('pre', m('code', `m(&quot;${selector}&quot;, ${JSON.stringify(vnode.attrs)}, ${vnode.text ? `&quot;${vnode.text}&quot;` : ''})`)),
        ,m('.table'
          ,Object.entries({ selector, ...where }).map(
            ([k,v]) =&gt;
              m('.row'
                  ,m('.key', k), m('.value', v)
              )
          )
        )
      ]
      : type == 'request'
      ? [
        ,m('pre', m('code', `m.request(&quot;${url}&quot;, ${JSON.stringify(options)})`))
        ,m('.table'
          ,Object.entries({ ...where }).map(
            ([k,v]) =&gt;
              m('.row'
                  ,m('.key', k), m('.value', v)
              )
          )
        )
      ]
      : null
    )
  ]
}))
</code></pre>
<h2 id="css" tabindex="-1">CSS <a class="direct-link" href="#css" aria-hidden="true">#</a></h2>
<pre><code class="language-css">.row {
  display: grid;
  grid-template-columns: 4em 1fr;
  gap: 1em;
}

.row .key {
  font-weight: bold;
}
</code></pre>
<p>The snippet requires the latest version 2.0.4 of Mithril.js framework.
As an expert user, who is familiar with all the aspects of Mithril.js and JavaScript itself, you are able the follow the example easily.</p>
<p>In this example we can see some <a href="/api-methods/">Mithril.js API methods</a> like <code>m.mount</code>, <code>m.redraw</code> or <code>m.request</code>, besides Mithril.js' basic m() hyperscript function.</p>
<p>The code sample was authored by JAForbes. It was last modified on 16 February 2022.</p>


        <h2 id="contribute" tabindex="-1">Contribute <a class="direct-link" href="#contribute" aria-hidden="true">#</a></h2>
<p>Do you see some improvements, that could be addressed here? Then let me know by <a href="https://github.com/tbreuss/mithril-by-examples/issues">opening an issue</a>.
As an alternative, you can fork the repository on GitHub, push your commits and send a pull request.
To start your work, click on the edit link below. Thank you for contributing to this repo.</p>


        <p style="margin-top:3.2rem;">
          <a href="/examples/">See more code examples</a>
          &nbsp;•&nbsp; <a target="_blank" href="https://github.com/tbreuss/mithril-by-examples/blob/main/./examples/redraw-event-introspect.md">Edit this example on GitHub</a>
        </p>

    </div>
  </div>
</div>

    <div class="footer">
      <div class="container">
          <div class="pure-g">
              <div class="pure-u-1 pure-u-md-3-5 footer-about">
                  <h3 class="footer-about__heading">Mithril.js by Examples</h3>
                  <p class="footer-about__text">The missing addition to Mithril.js' website with many up-to-date code examples that are often searched for and just work.</p>
              </div>
              <div class="pure-u-1-2 pure-u-md-1-5 footer-tools">
                <h3 class="footer-tools__heading">Toolset</h3>
                <ul class="footer-tools__list">
                    <li><a target="_blank" href="https://www.11ty.dev">Eleventy</a></li>
                    <li><a target="_blank" href="http://purecss.io">Pure.css</a></li>
                    <li><a target="_blank" href="https://flems.io">Flems.io</a></li>
                    <li><a target="_blank" href="http://mithril.js.org">Mithril.js</a></li>
                </ul>
            </div>
              <div class="pure-u-1-2 pure-u-md-1-5 footer-links">
                  <h3 class="footer-links__heading">Links</h3>
                  <ul class="footer-links__list">
                      <li><a href="/about/">About this website</a></li>
                      <li><a target="_blank" href="https://github.com/tbreuss/mithril-by-examples">GitHub Repository</a></li>
                  </ul>
              </div>
          </div>
          <hr class="footer-ruler">
          <div class="pure-g">
              <div class="pure-u-1 footer-copyright">
                  A tiny <a target="_blank" href="https://www.tebe.ch">tebe.ch</a> project
              </div>
          </div>
      </div>
  </div>
  <!-- Current page: /examples/redraw-event-introspect/ -->
  </body>
  <script src="/css/highlight/highlight.min.js?v=1649591713"></script>
  <script src="/js/main.js?v=1649591713"></script>
</html>
