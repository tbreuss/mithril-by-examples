<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="4spLhTDINzdede85HIlvHd0YVnKLKeP1Xw4FnIUaT1Q" />
    <title>Force Component Re-Init with Routing | Mithril.js by Examples</title>
    <link rel="stylesheet" href="/css/pure-min.css?v=1646032605">
    <link rel="stylesheet" href="/css/grids-responsive-min.css?v=1646032605">
    <link rel="stylesheet" href="/css/styles.css?v=1646032605">
    <link rel="stylesheet" href="/css/highlight/styles/atom-one-dark.min.css?v=1646032605">
    <script src="https://flems.io/flems.html" type="text/javascript" charset="utf-8"></script>
  </head>
  <body>
    <div class="header">
      <div class="container">
        <div class="pure-g custom-wrapper" id="menu">
            <div class="pure-u-1 pure-u-md-1-3">
              <div class="pure-menu">
                <a class="pure-menu-heading custom-brand" href="/"><img src="https://mithril.js.org/logo.svg" alt="">Mithril.js by Examples</a>
                <a href="#" class="custom-toggle" id="toggle"><s class="bar"></s><s class="bar"></s></a>
              </div>
            </div>
            <div class="pure-u-1 pure-u-md-2-3">
                <div class="pure-menu pure-menu-horizontal custom-can-transform">
                    <ul class="pure-menu-list">
                        <li class="pure-menu-item pure-menu-selected"><a class="pure-menu-link" href="/examples/">Examples</a></li>
                        <li class="pure-menu-item"><a class="pure-menu-link" href="/tags/">Tags</a></li>
                        <li class="pure-menu-item"><a class="pure-menu-link" href="/contributors/">Contributors</a></li>
                        <li class="pure-menu-item"><a class="pure-menu-link" href="/search/">Search</a></li>
                      </ul>
                </div>
            </div>
        </div>
    </div>
  </div>
    <div class="container content">
  <div class="pure-g">
      <div class="pure-u-1">

        <h1>Force Component Re-Init with Routing</h1>

        <p class="no-margin-bottom">
          <time datetime="2021-10-16">16 October 2021</time><span class="author">
            by&nbsp;<span class="author"><a href="/contributors/osban/">osban</a></span>
          </span>
        </p>
        <p class="no-margin-bottom">Level: <span class="level">beginner</span> â€¢ Mithril.js Version: <span class="version">2.0.4</span>
        </p>

        <p>
          
          
          <a href="/tags/component/" class="post-tag">component</a>
          
          
          <a href="/tags/key/" class="post-tag">key</a>
          
          
          <a href="/tags/m.route/" class="post-tag">m.route</a>
          
          
          <a href="/tags/oninit/" class="post-tag">oninit</a>
          
          
          <a href="/tags/vnode/" class="post-tag">vnode</a>
          
        </p>

        <div class="toc">
        <h2 class="toc__heading">Contents</h2>
        <ol class="toc__list"><li class="toc__item"><a clas="toc__link" href="#live-example">Live Example</a></li><li class="toc__item"><a clas="toc__link" href="#dependencies">Dependencies</a></li><li class="toc__item"><a clas="toc__link" href="#javascript">JavaScript</a></li><li class="toc__item"><a clas="toc__link" href="#contribute">Contribute</a></li></ol>
    </div>

        <p>This is an example that forces a component to re-initialize by passing a key attribute when changing routes (four examples).
Keys are used usually to distinguish similar vnodes from one another.
However, due to how Mithril.js treats keyed vnodes, we can use keys to force a vnode to be re-created.
This could be useful for situations wherein we want to, say, modify attributes of a 3rd-party component that doesn't provide an API to do so - we could simply force the component to be re-created with new values.</p>
<p>In this example we see four options with routing.
Date.now() is used to make sure the key is different each time.
Thus, on a redraw, when Mithril.js doesn't find a new vnode with the old key, it discards the old vnode, and creates a new one with the new key, and new values.</p>
<p>Keep in mind that every sibling needs a key, otherwise it doesn't work.</p>

      <h2 id="live-example">Live Example <a class="direct-link" href="#live-example" aria-hidden="true">#</a></h2>
      <div id="flems"></div>
      <script>
      Flems(document.getElementById("flems"), {
        middle: 0,
        resizable: false,
        editable: true,
        toolbar: true,
        autoHeight: false,
        selected: '.js',
        files: [{"name":".js","content":"// option 1 -> key is passed via attrs\nconst page1 = {\n  oninit: () => {console.log('init1')},\n  view: vnode => [\n    m('p', 'page1 ' + (vnode.attrs.key || '')),\n    m('button', {onclick: () => m.route.set('/page1', {key: Date.now()})}, 're-init')\n  ]\n}\n\n// option 2 -> key is passed as url parameter\nconst page2 = {\n  oninit: () => {console.log('init2')},\n  view: () => [\n    text(),\n    m('p', 'page2 ' + m.route.param('key')),\n    m('button', {onclick: () => m.route.set('/page2/' + Date.now())}, 're-init')\n  ]\n}\n\n// option 3 -> id is passed as url parameter and also used as key\nconst page3 = {\n  oninit: () => {console.log('init3')},\n  view: vnode => [\n    text(),\n    m('p', 'page3 ' + vnode.attrs.id),\n    m('button', {onclick: () => m.route.set('/page3/' + Date.now())}, 're-init')\n  ]\n}\n\n// option 4 -> use m.route.set() to re-init the current page\nconst page4 = {\n  oninit: () => {console.log('init4')},\n  view: vnode => [\n    text(),\n    m('p', 'page4 ' + (vnode.attrs.key || '')),\n    m('button', {onclick: () => m.route.set(m.route.get(), {key: Date.now()})}, 're-init')\n  ]\n}\n\nm.route(document.body, '/page1', { // change to /page2/1, /page3/1, or /page4\n  '/page1'     : page1,\n  '/page2/:key': page2,\n  '/page3/:id' : {render: vnode => m(page3, {id: vnode.attrs.id, key: vnode.attrs.id})},\n  '/page4'     : {render: vnode => m(page4, {key: vnode.attrs.key})}\n})\n"}],
        links: [{"name":"mithril@2.0.4","type":"script","url":"https://unpkg.com/mithril@2.0.4"}]
      });
      </script>
    
        <div class="dependencies">
          <h2 id="dependencies" class="dependencies__heading" tabindex="-1">Dependencies <a class="direct-link" href="#dependencies" aria-hidden="true">#</a></h2>
          <div class="dependencies__tableWrap">
            <table class="dependencies__table dependencies__table--1">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Name</th>
                        <th>URL</th>
                    </tr>
                </thead>
                <tbody>
                <tr><td class="capitalize">script</td><td>mithril@2.0.4</td><td>https://unpkg.com/mithril@2.0.4</td></tr>
                </tbody>
            </table>
          </div>
        </div>
      <h2 id="javascript" tabindex="-1">JavaScript <a class="direct-link" href="#javascript" aria-hidden="true">#</a></h2>
<pre><code class="language-js">// option 1 -&gt; key is passed via attrs
const page1 = {
  oninit: () =&gt; {console.log('init1')},
  view: vnode =&gt; [
    m('p', 'page1 ' + (vnode.attrs.key || '')),
    m('button', {onclick: () =&gt; m.route.set('/page1', {key: Date.now()})}, 're-init')
  ]
}

// option 2 -&gt; key is passed as url parameter
const page2 = {
  oninit: () =&gt; {console.log('init2')},
  view: () =&gt; [
    text(),
    m('p', 'page2 ' + m.route.param('key')),
    m('button', {onclick: () =&gt; m.route.set('/page2/' + Date.now())}, 're-init')
  ]
}

// option 3 -&gt; id is passed as url parameter and also used as key
const page3 = {
  oninit: () =&gt; {console.log('init3')},
  view: vnode =&gt; [
    text(),
    m('p', 'page3 ' + vnode.attrs.id),
    m('button', {onclick: () =&gt; m.route.set('/page3/' + Date.now())}, 're-init')
  ]
}

// option 4 -&gt; use m.route.set() to re-init the current page
const page4 = {
  oninit: () =&gt; {console.log('init4')},
  view: vnode =&gt; [
    text(),
    m('p', 'page4 ' + (vnode.attrs.key || '')),
    m('button', {onclick: () =&gt; m.route.set(m.route.get(), {key: Date.now()})}, 're-init')
  ]
}

m.route(document.body, '/page1', { // change to /page2/1, /page3/1, or /page4
  '/page1'     : page1,
  '/page2/:key': page2,
  '/page3/:id' : {render: vnode =&gt; m(page3, {id: vnode.attrs.id, key: vnode.attrs.id})},
  '/page4'     : {render: vnode =&gt; m(page4, {key: vnode.attrs.key})}
})
</code></pre>
<p>The snippet is using the most current version 2.0.4 of Mithril.js framework.
It is aimed at beginners and shows some basic recipes.</p>
<p>In addition to the Mithril.js hyperscript function m(), here we can see an example of Mithril.js' <code>m.route</code> <a href="/api-methods/">API method</a>.
It also shows, how Mithril.js' <a href="/lifecycle-methods/">lifecycle methods</a> can be used. This can be seen here by using the <code>oninit</code> hook.
In this example we can also see the usecase of Vnodes (virtual DOM nodes) which is a JavaScript data structure that describes a DOM tree.</p>
<p>The example was contributed by osban and last modified on 16 October 2021.
<a href="/contributors/osban/">Click here</a> to see more examples contributed by the author.</p>


        <h2 id="contribute" tabindex="-1">Contribute <a class="direct-link" href="#contribute" aria-hidden="true">#</a></h2>
<p>If anyone has some improvements, that should be addressed, let me know by <a href="https://github.com/tbreuss/mithril-by-examples/issues">opening an issue</a>.
Or simply fork the repository on GitHub, push your commits and send a pull request.
For starting your work, you can click the edit link below. Thanks for contributing.</p>


        <p style="margin-top:3.2rem;">
          <a href="/examples/">See more code examples</a>
          &nbsp;|&nbsp; <a target="_blank" href="https://github.com/tbreuss/mithril-by-examples/blob/main/./examples/force-component-reinit-with-routing.md">Edit this example on GitHub</a>
        </p>

    </div>
  </div>
</div>

    <div class="footer">
      <div class="container">
          <div class="pure-g">
              <div class="pure-u-1 pure-u-md-3-5 footer-about">
                  <h3 class="footer-about__heading">Mithril.js by Examples</h3>
                  <p class="footer-about__text">The missing addition to Mithril.js' website with many up-to-date code examples that are often searched for and just work...</p>
              </div>
              <div class="pure-u-1-2 pure-u-md-1-5 footer-tools">
                <h3 class="footer-tools__heading">Toolset</h3>
                <ul class="footer-tools__list">
                    <li><a target="_blank" href="https://www.11ty.dev">Eleventy</a></li>
                    <li><a target="_blank" href="http://purecss.io">Pure.css</a></li>
                    <li><a target="_blank" href="https://flems.io">Flems.io</a></li>
                    <li><a target="_blank" href="http://mithril.js.org">Mithril.js</a></li>
                </ul>
            </div>
              <div class="pure-u-1-2 pure-u-md-1-5 footer-links">
                  <h3 class="footer-links__heading">Links</h3>
                  <ul class="footer-links__list">
                      <li><a href="/about/">About this website</a></li>
                      <li><a target="_blank" href="https://github.com/tbreuss/mithril-by-examples">GitHub Repository</a></li>
                  </ul>
              </div>
          </div>
          <hr class="footer-ruler">
          <div class="pure-g">
              <div class="pure-u-1 footer-copyright">
                  A tiny <a target="_blank" href="https://www.tebe.ch">tebe.ch</a> project
              </div>
          </div>
      </div>
  </div>
  <!-- Current page: /examples/force-component-reinit-with-routing/ -->
  </body>
  <script src="/css/highlight/highlight.min.js?v=1646032605"></script>
  <script src="/js/main.js?v=1646032605"></script>
</html>
