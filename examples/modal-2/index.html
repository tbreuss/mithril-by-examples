<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="4spLhTDINzdede85HIlvHd0YVnKLKeP1Xw4FnIUaT1Q" />
    <title>Modal | Mithril by Examples</title>
    <link rel="stylesheet" href="/css/index.css?v=1638166964">
    <link rel="stylesheet" href="/css/highlight/styles/atom-one-dark.min.css?v=1638166964">
    <link rel="stylesheet" href="/css/modal.css?v=1638166964">
    <script src="https://flems.io/flems.html" type="text/javascript" charset="utf-8"></script>
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">Mithril by Examples</a></h1>
      <ul class="nav">
        <li class="nav-item nav-item-active"><a href="/examples/">Examples</a></li>
        <li class="nav-item"><a href="/tags/">Tags</a></li>
        <li class="nav-item"><a href="/contributors/">Contributors</a></li>
        <li class="nav-item"><a href="/search/">Search</a></li>
        <li class="nav-item"><a href="/about/">About</a></li>
      </ul>
    </header>
    <main class="content tmpl-post">
      <h1>Modal</h1>

<p>
  <time datetime="2021-10-26">26 October 2021</time><span class="author">
    by&nbsp;<span class="author"><a href="/contributors/spacejack/">spacejack</a></span>
  </span>
</p>
<p style="margin-top:-1em">Level: <span class="level">advanced</span> â€¢ Mithril Version: <span class="version">2.0.4</span>
</p>

<p><a href="/tags/component/" class="post-tag">component</a><a href="/tags/dialog/" class="post-tag">dialog</a><a href="/tags/dom/" class="post-tag">dom</a><a href="/tags/m.mount/" class="post-tag">m.mount</a><a href="/tags/m.redraw/" class="post-tag">m.redraw</a><a href="/tags/modal/" class="post-tag">modal</a><a href="/tags/onbeforeremove/" class="post-tag">onbeforeremove</a><a href="/tags/onbeforeupdate/" class="post-tag">onbeforeupdate</a><a href="/tags/oncreate/" class="post-tag">oncreate</a><a href="/tags/onremove/" class="post-tag">onremove</a>
</p><p>The code sample was authored by spacejack. It was last modified on 26 October 2021.
Want to see more examples written by spacejack? Then <a href="/contributors/spacejack/">Click here</a>.</p>
<p>The snippet requires the latest version 2.0.4 of Mithril JS framework.
More advanced users should be able to follow this example, however it contains some first difficulties.</p>
<p>In this example we can see some <a href="/api-methods/">Mithril API methods</a> like <code>m.mount</code> or <code>m.redraw</code>, besides Mithril's basic m() hyperscript function.
It also demonstrates, how Mithril's <a href="/lifecycle-methods/">lifecycle methods</a> (aka hooks) like <code>onbeforeupdate</code>, <code>onremove</code>, <code>onbeforeremove</code> and <code>oncreate</code> can be used.</p>
<p>Ready? Here we go!</p>



      <div class="modal-container">
        <label for="modal" class="example-label">Show Live Example in Flems</label>
        <label for="modal" class="modal-background"></label>
        <input type="checkbox" id="modal">
        <div class="modal">
          <div class="modal-header">
            <h3>Modal</h3>
            <label for="modal">
                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAdVBMVEUAAABNTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU1NTU0N3NIOAAAAJnRSTlMAAQIDBAUGBwgRFRYZGiEjQ3l7hYaqtLm8vsDFx87a4uvv8fP1+bbY9ZEAAAB8SURBVBhXXY5LFoJAAMOCIP4VBRXEv5j7H9HFDOizu2TRFljedgCQHeocWHVaAWStXnKyl2oVWI+kd1XLvFV1D7Ng3qrWKYMZ+MdEhk3gbhw59KvlH0eTnf2mgiRwvQ7NW6aqNmncukKhnvo/zzlQ2PR/HgsAJkncH6XwAcr0FUY5BVeFAAAAAElFTkSuQmCC" width="16" height="16" alt="">
            </label>
          </div>
          <div id="flems" class="modal-body"></div>
        </div>
      </div>
      <script>
      Flems(document.getElementById("flems"), {
        selected: 'app.js',
        files: [{"name":"Overlay.js","content":"// Overlay.js\n/**\nThis Overlay component provides a full-screen cover element.\nIt is mounted to a separate V/DOM tree appended to the body.\nChildren supplied to Overlay are rendered into this tree.\nThe Overlay component can be nested anywhere within your app's\nview but will be rendered to display overtop everything else.\n*/\n\nconst Overlay = function() {\n\tlet dom\n\tlet children\n\n\tconst OverlayContainer = {\n\t\tview: () => children\n\t}\n\n\treturn {\n\t\toncreate(v) {\n\t\t\tchildren = v.children\n\t\t\t// Append a container to the end of body\n\t\t\tdom = document.createElement('div')\n\t\t\tdom.className = 'overlay'\n\t\t\tdocument.body.appendChild(dom)\n\t\t\tm.mount(dom, OverlayContainer)\n\t\t},\n\t\tonbeforeupdate(v) {\n\t\t\tchildren = v.children\n\t\t},\n\t\tonbeforeremove(v) {\n\t\t\t// Add a class with fade-out exit animation\n\t\t\tdom.classList.add('hide')\n\t\t\treturn new Promise(r => {\n\t\t\t\tdom.addEventListener('animationend', r)\n\t\t\t})\n\t\t},\n\t\tonremove() {\n\t\t\tm.mount(dom, null)\n\t\t\t// Destroy the overlay dom tree. Using m.mount with\n\t\t\t// null triggers any modal children removal hooks.\n\t\t\tdocument.body.removeChild(dom)\n\t\t},\n\t\tview() {}\n\t}\n}\n"},{"name":"Modal.js","content":"// Modal.js\n/**\nThis Modal component uses the Overlay component to provide a\nfull screen cover and renders a dialog-like widget within that\nwaits for the user to click a button. A Modal instance can\nbe nested anywhere within your app's view and will be rendered\non top of everything else.\n\nExpected attrs are as follows:\n\ninterface Attrs {\n  title: m.Children\n  content: m.Children\n  buttons: {id: string, text: string}[]\n  onClose(id: string): void\n}\n\nAt least one button should be provided otherwise there\nwill be no way to close the modal.\n*/\n\nconst Modal = function(v) {\n  let clickedId\n\n  return {\n    view({attrs: {title, content, buttons, onClose}}) {\n      if (clickedId != null) {\n        // We need to allow the Overlay component execute its\n        // exit animation. Because it is a child of this component,\n        // it will not fire when this component is removed.\n        // Instead, we need to remove it first before this component\n        // goes away.\n\t\t\t\t// When a button is clicked, we omit the Overlay component\n        // from this Modal component's next view render, which will\n        // trigger Overlay's onbeforeremove hook.\n        return null\n      }\n      return m(Overlay,\n        {\n          onremove() {\n            // Wait for the overlay's removal animation to complete.\n            // Then we fire our parent's callback, which will\n            // presumably remove this Modal component.\n            Promise.resolve().then(() => {\n              onClose(clickedId)\n              m.redraw()\n            })\n          }\n        },\n        m('.modal',\n          m('h3', title),\n          m('.modal-content', content),\n          m('.modal-buttons',\n            buttons.map(b =>\n              m('button',\n                {\n                  type: 'button',\n                  disabled: clickedId != null,\n                  onclick() {\n                    clickedId = b.id\n                  }\n                },\n                b.text\n              )\n            )\n          )\n        )\n      )\n    }\n  }\n}\n"},{"name":"app.js","content":"// app.js\nconst App = function() {\n  let showModal = false\n\n  return {\n    view: () => m('.app',\n      m('h1', 'Modal Demo'),\n      m('p', 'Click below to open a modal'),\n      m('p',\n        m('button',\n          {\n            type: 'button',\n            onclick() {\n              showModal = true\n            }\n          },\n          'Open Modal'\n        ),\n        // Even though this modal is nested within our App vdom,\n        // it will appear on top of everything else, appended\n        // to the end of document body.\n        showModal && m(Modal, {\n          title: 'Hello Modal!',\n          content: 'Click the button below to close.',\n          buttons: [{id: 'close', text: 'Close'}],\n          onClose(id) {\n            showModal = false\n          }\n        })\n      )\n    )\n  }\n}\n\nm.mount(document.body, App)\n"},{"name":".css","content":"body {\n  margin: 0;\n  padding: 0;\n  font-family: sans-serif;\n  font-size: 16px;\n}\n\n.app {\n  padding: 2em;\n}\n\n@keyframes fade-in {\n  from {opacity: 0;}\n  to {opacity: 1;}\n}\n\n@keyframes fade-out {\n  from {opacity: 1;}\n  to {opacity: 0;}\n}\n\n.overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(255,255,255,0.75);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  animation: fade-in 0.5s;\n}\n.overlay.hide {\n  animation: fade-out 0.5s;\n}\n\n.modal {\n  text-align: center;\n  padding: 2em 4em 3em 4em;\n  background-color: #FFF;\n  box-shadow: 0.5em 0.5em 2em #999;\n  border: #CCC 1px solid;\n}\n\n.modal-buttons {\n  margin-top: 1em;\n}\n.modal-buttons button {\n  margin: 0 0.5em;\n}\n"}],
        links: [{"name":"mithril@2.0.4","type":"script","url":"https://unpkg.com/mithril@2.0.4"}]
      });
      </script>
    
        <div class="dependencies">
          <h2 id="dependencies" class="dependencies__heading" tabindex="-1">Dependencies</h2>
          <div class="dependencies__tableWrap">
            <table class="dependencies__table dependencies__table--1">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Name</th>
                        <th>URL</th>
                    </tr>
                </thead>
                <tbody>
                <tr><td class="capitalize">script</td><td>mithril@2.0.4</td><td>https://unpkg.com/mithril@2.0.4</td></tr>
                </tbody>
            </table>
          </div>
        </div>
        <style>
        .dependencies {
            color: #282c34;
            margin-bottom: 2rem;
        }
        .dependencies__tableWrap {
            background-color: #282c34;
            display: block;
            overflow-x: auto;
        }
        /* strange things happen here */
        .dependencies__table {
            margin: -1rem 0 0 0 !important;
            padding: 1em;
        }
        .dependencies__table--1 {
            margin-top: 0 !important;
        }
        .dependencies__table th, .dependencies__table td {
            color: #abb2bf;
            font-family: Consolas, Menlo, Monaco, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", "Courier New", Courier, monospace;
            font-size: 14px;
        }
        .dependencies__table th {
          text-align: left;
        }
        .capitalize {
            text-transform: capitalize;
        }
        </style>
      

<h2 id="overlay.js" tabindex="-1">Overlay.js <a class="direct-link" href="#overlay.js" aria-hidden="true">#</a></h2>
<pre><code class="language-js">// Overlay.js
/**
This Overlay component provides a full-screen cover element.
It is mounted to a separate V/DOM tree appended to the body.
Children supplied to Overlay are rendered into this tree.
The Overlay component can be nested anywhere within your app's
view but will be rendered to display overtop everything else.
*/

const Overlay = function() {
	let dom
	let children

	const OverlayContainer = {
		view: () =&gt; children
	}

	return {
		oncreate(v) {
			children = v.children
			// Append a container to the end of body
			dom = document.createElement('div')
			dom.className = 'overlay'
			document.body.appendChild(dom)
			m.mount(dom, OverlayContainer)
		},
		onbeforeupdate(v) {
			children = v.children
		},
		onbeforeremove(v) {
			// Add a class with fade-out exit animation
			dom.classList.add('hide')
			return new Promise(r =&gt; {
				dom.addEventListener('animationend', r)
			})
		},
		onremove() {
			m.mount(dom, null)
			// Destroy the overlay dom tree. Using m.mount with
			// null triggers any modal children removal hooks.
			document.body.removeChild(dom)
		},
		view() {}
	}
}
</code></pre>
<h2 id="modal.js" tabindex="-1">Modal.js <a class="direct-link" href="#modal.js" aria-hidden="true">#</a></h2>
<pre><code class="language-js">// Modal.js
/**
This Modal component uses the Overlay component to provide a
full screen cover and renders a dialog-like widget within that
waits for the user to click a button. A Modal instance can
be nested anywhere within your app's view and will be rendered
on top of everything else.

Expected attrs are as follows:

interface Attrs {
  title: m.Children
  content: m.Children
  buttons: {id: string, text: string}[]
  onClose(id: string): void
}

At least one button should be provided otherwise there
will be no way to close the modal.
*/

const Modal = function(v) {
  let clickedId

  return {
    view({attrs: {title, content, buttons, onClose}}) {
      if (clickedId != null) {
        // We need to allow the Overlay component execute its
        // exit animation. Because it is a child of this component,
        // it will not fire when this component is removed.
        // Instead, we need to remove it first before this component
        // goes away.
				// When a button is clicked, we omit the Overlay component
        // from this Modal component's next view render, which will
        // trigger Overlay's onbeforeremove hook.
        return null
      }
      return m(Overlay,
        {
          onremove() {
            // Wait for the overlay's removal animation to complete.
            // Then we fire our parent's callback, which will
            // presumably remove this Modal component.
            Promise.resolve().then(() =&gt; {
              onClose(clickedId)
              m.redraw()
            })
          }
        },
        m('.modal',
          m('h3', title),
          m('.modal-content', content),
          m('.modal-buttons',
            buttons.map(b =&gt;
              m('button',
                {
                  type: 'button',
                  disabled: clickedId != null,
                  onclick() {
                    clickedId = b.id
                  }
                },
                b.text
              )
            )
          )
        )
      )
    }
  }
}
</code></pre>
<h2 id="app.js" tabindex="-1">app.js <a class="direct-link" href="#app.js" aria-hidden="true">#</a></h2>
<pre><code class="language-js">// app.js
const App = function() {
  let showModal = false

  return {
    view: () =&gt; m('.app',
      m('h1', 'Modal Demo'),
      m('p', 'Click below to open a modal'),
      m('p',
        m('button',
          {
            type: 'button',
            onclick() {
              showModal = true
            }
          },
          'Open Modal'
        ),
        // Even though this modal is nested within our App vdom,
        // it will appear on top of everything else, appended
        // to the end of document body.
        showModal &amp;&amp; m(Modal, {
          title: 'Hello Modal!',
          content: 'Click the button below to close.',
          buttons: [{id: 'close', text: 'Close'}],
          onClose(id) {
            showModal = false
          }
        })
      )
    )
  }
}

m.mount(document.body, App)
</code></pre>
<h2 id="css" tabindex="-1">CSS <a class="direct-link" href="#css" aria-hidden="true">#</a></h2>
<pre><code class="language-css">body {
  margin: 0;
  padding: 0;
  font-family: sans-serif;
  font-size: 16px;
}

.app {
  padding: 2em;
}

@keyframes fade-in {
  from {opacity: 0;}
  to {opacity: 1;}
}

@keyframes fade-out {
  from {opacity: 1;}
  to {opacity: 0;}
}

.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(255,255,255,0.75);
  display: flex;
  justify-content: center;
  align-items: center;
  animation: fade-in 0.5s;
}
.overlay.hide {
  animation: fade-out 0.5s;
}

.modal {
  text-align: center;
  padding: 2em 4em 3em 4em;
  background-color: #FFF;
  box-shadow: 0.5em 0.5em 2em #999;
  border: #CCC 1px solid;
}

.modal-buttons {
  margin-top: 1em;
}
.modal-buttons button {
  margin: 0 0.5em;
}
</code></pre>


<p>Do you see some improvements, that could be addressed here? Then let me know by <a href="https://github.com/tbreuss/mithril-by-examples/issues">opening an issue</a>.
As an alternative, you can fork the repository on GitHub, push your commits and send a pull request.
To start your work, click on the edit link below. Thank you for contributing to this repo.</p>


<p style="margin-top:2rem;">
  <a href="/examples/">See more code examples</a>
  &nbsp;|&nbsp; <a target="_blank" href="https://github.com/tbreuss/mithril-by-examples/blob/main/./examples/modal-2.md">Edit this example on GitHub</a>
</p>

    </main>
    <footer></footer>
    <!-- Current page: /examples/modal-2/ -->
  </body>
  <script src="/css/highlight/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
</html>
